{"ast":null,"code":"import _regeneratorRuntime from\"/Users/mac/Work/frontend/React/itine/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/mac/Work/frontend/React/itine/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/mac/Work/frontend/React/itine/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import client from\"../utils/jwtInterceptor\";import{createContext,useContext,useEffect,useState}from\"react\";import{useNavigate}from\"react-router-dom\";import{useLogin}from\"../hooks/useAuthApi\";import{Get}from\"../utils/axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export var AuthContextProvider=function AuthContextProvider(_ref){var children=_ref.children;var _useState=useState(function(){var userProfile=localStorage.getItem(\"userProfile\");if(userProfile){return JSON.parse(userProfile);}return null;}),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var navigate=useNavigate();var _useLogin=useLogin({onSuccess:function onSuccess(data){// props.onSuccess?.(data.data);\n},onError:function onError(error){console.error(\"[on error]\",error);}}),signIn=_useLogin.mutate;var login=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(payload){var apiResponse;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;signIn(payload,{onSuccess:function onSuccess(){navigate(\"/login\");},onError:function onError(error){// TODO: Add a loading and show it when request is pending\n}});_context.next=4;return Get(\"auth/profile\");case 4:apiResponse=_context.sent;localStorage.setItem(\"userProfile\",JSON.stringify(apiResponse.data));setUser(apiResponse.data);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 12:case\"end\":return _context.stop();}},_callee,null,[[0,9]]);}));return function login(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){try{var token=localStorage.getItem(\"userProfile\");if(!token){navigate(\"/login\");}}catch(error){return;}},[navigate]);var logout=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return client.get(\"auth/logout\");case 2:localStorage.removeItem(\"userProfile\");setUser(null);navigate(\"/login\");case 5:case\"end\":return _context2.stop();}},_callee2);}));return function logout(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user:user,login:login,logout:logout},children:children})});};export var useAuthContext=function useAuthContext(){return useContext(AuthContext);};","map":{"version":3,"names":["client","createContext","useContext","useEffect","useState","useNavigate","useLogin","Get","jsx","_jsx","Fragment","_Fragment","AuthContext","AuthContextProvider","_ref","children","_useState","userProfile","localStorage","getItem","JSON","parse","_useState2","_slicedToArray","user","setUser","navigate","_useLogin","onSuccess","data","onError","error","console","signIn","mutate","login","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","payload","apiResponse","wrap","_callee$","_context","prev","next","sent","setItem","stringify","t0","log","stop","_x","apply","arguments","token","logout","_ref3","_callee2","_callee2$","_context2","get","removeItem","Provider","value","useAuthContext"],"sources":["/Users/mac/Work/frontend/React/itine/src/contexts/AuthContext.jsx"],"sourcesContent":["import client from \"../utils/jwtInterceptor\";\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useLogin } from \"../hooks/useAuthApi\";\nimport { Get } from \"../utils/axios\";\n\nconst AuthContext = createContext();\n\nexport const AuthContextProvider = ({ children }) => {\n  const [user, setUser] = useState(() => {\n    let userProfile = localStorage.getItem(\"userProfile\");\n    if (userProfile) {\n      return JSON.parse(userProfile);\n    }\n    return null;\n  });\n\n  const navigate = useNavigate();\n  const { mutate: signIn } = useLogin({\n    onSuccess: (data) => {\n      // props.onSuccess?.(data.data);\n    },\n    onError(error) {\n      console.error(\"[on error]\", error);\n    },\n  });\n  const login = async (payload) => {\n    try {\n      signIn(payload, {\n        onSuccess: () => {\n          navigate(\"/login\");\n        },\n        onError(error) {\n          // TODO: Add a loading and show it when request is pending\n        },\n      });\n      let apiResponse = await Get(\"auth/profile\");\n      localStorage.setItem(\"userProfile\", JSON.stringify(apiResponse.data));\n      setUser(apiResponse.data);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  useEffect(() => {\n    try {\n      const token = localStorage.getItem(\"userProfile\");\n      if (!token) {\n        navigate(\"/login\");\n      }\n    } catch (error) {\n      return;\n    }\n  }, [navigate]);\n\n  const logout = async () => {\n    await client.get(\"auth/logout\");\n    localStorage.removeItem(\"userProfile\");\n    setUser(null);\n    navigate(\"/login\");\n  };\n\n  return (\n    <>\n      <AuthContext.Provider value={{ user, login, logout }}>\n        {children}\n      </AuthContext.Provider>\n    </>\n  );\n};\n\nexport const useAuthContext = () => useContext(AuthContext);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}